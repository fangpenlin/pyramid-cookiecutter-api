machine:
  python:
    version: 3.5.2
  services:
    - postgresql
dependencies:
  cache_directories:
    - /home/ubuntu/.cache/pip/
  override:
    - 'pip install -U pip'
    - 'pip install wheel'
    - 'pip install cookiecutter'

test:
  pre:
    - 'cookiecutter --no-input .'
  override:
    - 'cd pyramid_api && .env/bin/py.test -svvv'

deployment:
  archive:
    branch: master
    commands:
      - echo $GITHUB_DEPLOY_ID_RSA > ~/.ssh/github_deploy_id_rsa
      - chmod 400 ~/.ssh/github_deploy_id_rsa
      - eval `ssh-agent` && ssh-add ~/.ssh/github_deploy_id_rsa && ./archive.sh
