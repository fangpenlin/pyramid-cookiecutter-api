machine:
  python:
    version: 3.5.2
  services:
    - postgresql
dependencies:
  cache_directories:
    - /home/ubuntu/.cache/pip/
  override:
    - 'pip install -U pip'
    - 'pip install wheel'
    - 'pip install cookiecutter'
    - 'pip install flake8'

test:
  pre:
    - 'cookiecutter --no-input .'
  override:
    - 'cd pyramid_api && .env/bin/py.test -svvv'
    - 'cd pyramid_api && flake8 pyramid_api --ignore=E501,W293'

deployment:
  archive:
    branch: master
    commands:
      - echo $GITHUB_DEPLOY_ID_RSA > ~/.ssh/github_deploy_id_rsa
      - GIT_SSH_COMMAND="ssh -i ~/.ssh/github_deploy_id_rsa" ./archive.sh
